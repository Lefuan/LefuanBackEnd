<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ Simulaciones Kuramoto - Framework P-O-D-B</title>
    <style>
        /* ===== CSS EXACTAMENTE IGUAL QUE LA P√ÅGINA PRINCIPAL ===== */
        body {
            background-color: #0d1117;
            color: #e6edf3;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            text-align: center;
            transform: scale(0.7);
            transform-origin: top left;
            width: 142.857%;
        }

        header { 
            padding: 50px 20px; 
            position: relative; 
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 400px));
            gap: 20px;
            padding: 20px;
            max-width: 1500px;
            margin: 0 auto;
            justify-content: center; 
        }

        .grid-container > div[style*="flex"] {
            grid-column: 1 / -1;
        }

        .card {
            background: #161b22;
            border: 1px solid #30363d;
            padding: 20px;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-10px);
            border-color: #58a6ff;
        }

        .btn {
            display: inline-block;
            margin-top: 0px;
            padding: 10px 20px;
            background-color: #238636;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        .btn:hover {
            filter: brightness(1.2);
        }

        .btn:disabled {
            background-color: #4a4a5a;
            cursor: not-allowed;
            filter: none;
        }

        .social-hub {
            grid-column: 1 / -1;
            width: 100%;
            margin: 10px 0;
            padding: 10px 0;
            background: #161b22;
            border-top: 1px solid #30363d;
            border-bottom: 1px solid #30363d;
        }

        .links-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: nowrap;
            overflow-x: hidden;
            padding: 20px;
        }

        .social-link {
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9em;
            transition: 0.3s;
            color: #fff;
            min-width: 100px;
        }

        .btn-pdf {
            background-color: #222 !important;
            color: #4caf50 !important;
            font-weight: bold;
        }

        .btn-volver {
            background: transparent;
            border: none;
            color: #8b949e;
            cursor: pointer;
            margin-top: 0px;
            font-size: 0.8em;
        }

        .btn-volver:hover {
            color: white;
        }

        .break {
            flex-basis: 100%;
            height: 0;
        }

        /* Colores tem√°ticos */
        .math { border-left: 5px solid #79c0ff; }
        .bloodbowl { border-left: 5px solid #da3633; }
        .physics { border-left: 5px solid #d2a8ff; }
        .essay { border-left: 5px solid #3fb950; }

        /* Colores de marca */
        .reddit { background: #FF4500; }
        .youtube { background: #FF0000; }
        .podcast { background: #8735fb; }
        .github { background: #24292e; border: 1px solid #444; }
        .archive { background: #000000; border: 1px solid #666; }
        .Images { background: #bd081c !important; }

        .social-link:hover {
            filter: brightness(1.2);
            transform: scale(1.05);
        }

        .desplegable {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .btn-group {
            display: inline-flex;
            vertical-align: middle;
            margin: 5px;
        }

        .btn-group .btn-left {
            margin-top: 0px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: 1px solid rgba(0,0,0,0.2);
        }

        .btn-group .btn-right {
            margin-top: 0px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            padding-left: 15px;
            padding-right: 15px;
        }

        #pdf-drawer {
            position: fixed !important;
            left: 20px !important;
            top: 120px !important;
            right: 20px !important;
            bottom: 50px !important;
            width: auto !important;
            height: auto !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 0;
            background: rgba(255,255,255,0.02);
            border: 3px solid orange;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 0;
            box-shadow: 0 0 20px rgba(255,165,0,0.3);
            z-index: 1000;
        }

        #pdf-drawer .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: #111;
            border-bottom: 2px solid orange;
            border-radius: 12px 12px 0 0;
        }

        #pdf-title {
            font-size: 1.4em;
            color: #00ffe1;
            margin: 0;
        }

        .pdf-actions {
            display: flex;
            gap: 10px;
        }

        #pdf-frame {
            width: 100% !important;
            height: calc(100% - 50px) !important;
            min-height: 600px;
            border: none;
            border-radius: 0 0 12px 12px;
            background: #000;
        }

        /* ===== ESTILOS PROPIOS DE LA SIMULACI√ìN ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #161b22;
            border-radius: 20px;
            border: 1px solid #30363d;
            overflow: hidden;
            margin-top: 30px;
        }

        .content {
            padding: 30px;
        }

        .selector-panel {
            background: #161b22;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #30363d;
        }
        
        .selector-panel h2 {
            color: #e6edf3;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .script-card {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .script-card:hover {
            transform: translateY(-5px);
            border-color: #58a6ff;
        }
        
        .script-card.selected {
            border-color: #58a6ff;
            background: #1a1f2a;
        }
        
        .script-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #e6edf3;
            margin-bottom: 8px;
        }
        
        .script-desc {
            color: #8b949e;
            font-size: 0.95em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .script-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #0d1117;
            color: #58a6ff;
            border: 1px solid #58a6ff;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .param-panel {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .param-panel h4 {
            color: #e6edf3;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .param-row {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .param-row label {
            font-weight: 500;
            color: #8b949e;
            min-width: 150px;
        }
        
        .param-row select {
            padding: 8px 12px;
            border: 1px solid #30363d;
            border-radius: 5px;
            font-size: 14px;
            background: #0d1117;
            color: #e6edf3;
            cursor: pointer;
        }
        
        .param-row select:hover {
            border-color: #58a6ff;
        }

        .control-panel {
            background: transparent;
            padding: 20px 0;
            margin-top: 20px;
        }

        .btn-ejecutar {
            background-color: #238636;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .btn-ejecutar:hover {
            filter: brightness(1.2);
            transform: scale(1.05);
        }
        
        .btn-ejecutar:disabled {
            background-color: #4a4a5a;
            cursor: not-allowed;
            transform: none;
            filter: none;
        }

        .results {
            margin-top: 30px;
            border-top: 2px solid #30363d;
            padding-top: 25px;
        }
        
        .results h3 {
            color: #e6edf3;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        #output {
            background: #0d1117;
            color: #e6edf3;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #30363d;
        }
        
        #plots {
            text-align: center;
            background: #0d1117;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #30363d;
        }
        
        #plots img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        footer {
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid #30363d;
            color: #8b949e;
        }
    </style>
</head>
<body>
    <!-- HEADER ID√âNTICO AL DE LA P√ÅGINA PRINCIPAL -->
    <header style="position: relative; text-align: center; margin-bottom: 30px;">
        <h1 style="margin: 0; font-size: 2em;">LEFUAN</h1>
        <p style="margin: 0; font-size: 1em;">Exploraciones en Laniakea: Ciencia, Estrategia y Pensamiento</p>
        <img src="https://lefuan.neocities.org/Vida.png" alt="Logo Lefuan" 
             style="position: absolute; right: 15%; top: 50%; transform: translateY(-50%); height: 140px; width: auto; border-radius: 8px;">
    </header>

    <!-- CONTENEDOR PRINCIPAL DE LA SIMULACI√ìN -->
    <div class="container">
        <div class="content">
            <div class="selector-panel">
                <h2>üìÅ Selecciona un script para ejecutar:</h2>

                <div class="script-grid" id="scriptGrid"></div>

                <div class="param-panel" id="paramPanel" style="display: none;">
                    <h4>‚öôÔ∏è Par√°metros del script:</h4>
                    <div id="parametros-dinamicos"></div>
                </div>

                <div class="control-panel">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <button class="btn-ejecutar" id="btnEjecutar" disabled>
                            ‚ñ∂ Ejecutar Simulaci√≥n
                        </button>
                    </div>
                </div>
            </div>

            <div class="results">
                <h3>üìä Resultados:</h3>
                <div id="output">Selecciona un script y haz clic en Ejecutar</div>
                <div id="plots"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>Lefuan œï 2025 - Creado en Laniakea</p>
    </footer>

    <script>
        // ============================================
        // CONFIGURACI√ìN
        // ============================================
        const API_URL = 'https://peculiar-ilysa-lefuan-f5eb738f.koyeb.app';

        // ============================================
        // SCRIPTS DISPONIBLES
        // ============================================
        const SCRIPTS = [
            { id: 'hito1', nombre: 'üåÄ Hito 1 - KuramotoPRO', desc: 'Modelo base de 3 niveles (1+3+9 plataformas)', badge: 'Base' },
            { id: 'hito2', nombre: 'üìä Hito 2 - Kuramoto Explorer', desc: 'Exploraci√≥n de K_intra y K_inter en 3 niveles', badge: '3 niveles' },
            { id: 'hito3', nombre: '‚öôÔ∏è Hito 3 - Kuramoto7_1', desc: 'Simulaci√≥n de N niveles jer√°rquicos', badge: 'N niveles' },
            { id: 'hito4', nombre: 'üìà Hito 4 - Modelo 46 Capas', desc: 'Extrapolaci√≥n a 46 niveles con par√°metros de orden', badge: '46 capas' },
            { id: 'hito5', nombre: 'üîÑ Hito 5 - Kuramoto7_4', desc: 'Exploraci√≥n de 7 topolog√≠as diferentes', badge: '7 topolog√≠as' },
            { id: 'hito6', nombre: 'üî¨ Hito 6 - KuramotoPODB', desc: 'Estados P-O-D-B por conexi√≥n', badge: 'PODB' },
            { id: 'hito7', nombre: 'üöÄ Hito 7 - MacroPODB', desc: 'Versi√≥n unificada con todas las opciones', badge: 'Unificado' }
        ];

        // ============================================
        // PAR√ÅMETROS POR SCRIPT CON DESCRIPCIONES
        // ============================================
        const PARAMETROS_SCRIPT = {
            'hito3': [
                { 
                    nombre: 'niveles', 
                    tipo: 'select', 
                    opciones: [3,4,5,6], 
                    default: 6, 
                    label: 'üìä N√∫mero de niveles',
                    desc: 'Cantidad de capas jer√°rquicas a simular (3-6). M√°s niveles = m√°s complejidad.'
                }
            ],
            'hito5': [
                { 
                    nombre: 'opcion', 
                    tipo: 'select', 
                    opciones: [1,2,3,4,5,6,7], 
                    default: 6, 
                    label: 'üîÑ Topolog√≠a',
                    desc: '1=Global+Jer√°rquica | 2=Anillo | 3=Scale-free | 4=Estrella | 5=Global+Malla | 6=Scale-free+Malla (MEJOR) | 7=Scale-free+Global'
                }
            ],
            'hito6': [
                { 
                    nombre: 'niveles', 
                    tipo: 'select', 
                    opciones: [2,3,4], 
                    default: 3, 
                    label: 'üìä Niveles PODB',
                    desc: 'N√∫mero de niveles para el modelo con estados P-O-D-B (2-4)'
                },
                { 
                    nombre: 'metros', 
                    tipo: 'select', 
                    opciones: [3,4], 
                    default: 4, 
                    label: 'üéØ Metr√≥nomos/plataforma',
                    desc: 'Cantidad de osciladores por cada plataforma (3-4)'
                }
            ],
            'hito7': [
                { 
                    nombre: 'opcion', 
                    tipo: 'select', 
                    opciones: [1,2,3,4,5,6,7], 
                    default: 6, 
                    label: 'üîÑ Topolog√≠a',
                    desc: '1=Global+Jer√°rquica | 2=Anillo | 3=Scale-free | 4=Estrella | 5=Global+Malla | 6=Scale-free+Malla (MEJOR) | 7=Scale-free+Global'
                },
                { 
                    nombre: 'niveles', 
                    tipo: 'select', 
                    opciones: [3,4,5,6], 
                    default: 5, 
                    label: 'üìä Niveles',
                    desc: 'N√∫mero de capas jer√°rquicas en la simulaci√≥n unificada'
                },
                { 
                    nombre: 'modo', 
                    tipo: 'select', 
                    opciones: ['clasico', 'podb'], 
                    default: 'podb', 
                    label: '‚öôÔ∏è Modo',
                    desc: 'clasico = K fijo | podb = K variable por estado (P-O-D-B)'
                }
            ]
        };

        let scriptSeleccionado = null;

        // ============================================
        // RENDERIZAR TARJETAS
        // ============================================
        const scriptGrid = document.getElementById('scriptGrid');

        SCRIPTS.forEach(script => {
            const card = document.createElement('div');
            card.className = 'script-card';
            card.onclick = () => seleccionarScript(script.id);
            card.id = `card-${script.id}`;

            card.innerHTML = `
                <div class="script-name">${script.nombre}</div>
                <div class="script-desc">${script.desc}</div>
                <span class="script-badge">${script.badge}</span>
            `;

            scriptGrid.appendChild(card);
        });

        // ============================================
        // FUNCIONES DE SELECCI√ìN
        // ============================================
        function seleccionarScript(id) {
            scriptSeleccionado = id;

            document.querySelectorAll('.script-card').forEach(c => {
                c.classList.remove('selected');
            });
            document.getElementById(`card-${id}`).classList.add('selected');
            
            document.getElementById('btnEjecutar').disabled = false;
            
            const script = SCRIPTS.find(s => s.id === id);
            document.getElementById('output').innerText = `‚úÖ Script seleccionado: ${script.nombre}`;
            
            mostrarParametros(id);
        }

        // ============================================
        // FUNCI√ìN PARA MOSTRAR PAR√ÅMETROS CON DESCRIPCI√ìN
        // ============================================
        function mostrarParametros(scriptId) {
            const panel = document.getElementById('paramPanel');
            const div = document.getElementById('parametros-dinamicos');
            
            if (!PARAMETROS_SCRIPT[scriptId]) {
                panel.style.display = 'none';
                return;
            }
            
            panel.style.display = 'block';
            let html = '';
            
            PARAMETROS_SCRIPT[scriptId].forEach(param => {
                html += `<div class="param-row">`;
                html += `<label>${param.label}:</label>`;
                
                if (param.tipo === 'select') {
                    html += `<select id="param-${param.nombre}" style="width: auto; min-width: 150px;">`;
                    param.opciones.forEach(val => {
                        html += `<option value="${val}" ${val === param.default ? 'selected' : ''}>${val}</option>`;
                    });
                    html += `</select>`;
                }
                
                html += `</div>`;
                
                // A√±adir descripci√≥n debajo del selector
                if (param.desc) {
                    html += `<div style="margin: 5px 0 15px 160px; font-size: 0.9em; color: #8b949e; font-style: italic; border-left: 2px solid #58a6ff; padding-left: 10px;">`;
                    html += `${param.desc}`;
                    html += `</div>`;
                }
            });
            
            div.innerHTML = html;
        }

        // ============================================
        // EJECUTAR SCRIPT
        // ============================================
        async function ejecutarScript() {
            if (!scriptSeleccionado) {
                alert('Selecciona un script primero');
                return;
            }

            const btn = document.getElementById('btnEjecutar');
            const outputEl = document.getElementById('output');
            const plotsEl = document.getElementById('plots');

            btn.disabled = true;
            outputEl.innerText = '‚è≥ Ejecutando en servidor...';
            plotsEl.innerHTML = '';

            try {
                // Recoger par√°metros
                const params = {};
                if (PARAMETROS_SCRIPT[scriptSeleccionado]) {
                    PARAMETROS_SCRIPT[scriptSeleccionado].forEach(param => {
                        const input = document.getElementById(`param-${param.nombre}`);
                        if (input) params[param.nombre] = input.value;
                    });
                }

                // JSONP
                const callbackName = 'callback_' + Date.now();

                const result = await new Promise((resolve, reject) => {
                    window[callbackName] = function(data) {
                        resolve(data);
                        delete window[callbackName];
                        if (script) document.head.removeChild(script);
                    };

                    let url = `${API_URL}/ejecutar/${scriptSeleccionado}?callback=${callbackName}`;
                    if (Object.keys(params).length > 0) {
                        url += '&' + new URLSearchParams(params).toString();
                    }

                    const script = document.createElement('script');
                    script.src = url;
                    script.onerror = () => reject(new Error('Error de conexi√≥n'));
                    document.head.appendChild(script);

                    setTimeout(() => reject(new Error('Timeout')), 60000);
                });

                if (result.success) {
                    outputEl.innerText = result.output || '‚úÖ Simulaci√≥n completada';

                    if (result.imagenes && result.imagenes.length > 0) {
                        let html = '';
                        result.imagenes.forEach((img, index) => {
                            html += `<img src="data:image/png;base64,${img}" alt="Gr√°fica ${index+1}" style="max-width: 100%; margin-bottom: 20px;">`;
                        });
                        plotsEl.innerHTML = html;
                    } else {
                        plotsEl.innerHTML = '<p>‚ö†Ô∏è El script no gener√≥ gr√°ficas</p>';
                    }
                } else {
                    outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${result.error || 'Error desconocido'}</span>`;
                }
            } catch (error) {
                outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${error.message}</span>`;
            } finally {
                btn.disabled = false;
            }
        }

        document.getElementById('btnEjecutar').onclick = ejecutarScript;
    </script>
</body>
</html>
