<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ Simulaciones Kuramoto - Framework P-O-D-B</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }

        .selector-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .selector-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .script-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .script-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .script-card.selected {
            border-color: #3498db;
            background: #ebf5ff;
        }
        .script-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .script-desc {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .script-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e1f5fe;
            color: #0288d1;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        .btn-ejecutar {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        .btn-ejecutar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }
        .btn-ejecutar:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results {
            margin-top: 30px;
            border-top: 2px solid #e9ecef;
            padding-top: 25px;
        }
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        #plots {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        #plots img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåÄ Framework P-O-D-B</h1>
            <p>Simulaciones de Kuramoto jer√°rquico con estados Part√≠cula-Onda-Difuso-Borrado</p>
        </div>

        <div class="content">
            <div class="selector-panel">
                <h2>üìÅ Selecciona un script para ejecutar:</h2>

                <div class="script-grid" id="scriptGrid">
                    <!-- Las tarjetas se generar√°n con JavaScript -->
                </div>

                <div class="control-panel">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <button class="btn-ejecutar" id="btnEjecutar" onclick="ejecutarScript()" disabled>
                            ‚ñ∂ Ejecutar Simulaci√≥n
                        </button>
                    </div>
                </div>
            </div>

            <div class="results">
                <h3>üìä Resultados:</h3>
                <div id="output">Selecciona un script y haz clic en Ejecutar</div>
                <div id="plots"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN - CAMBIA ESTA URL POR LA DE KOYEB
        // ============================================
        const API_URL = 'https://peculiar-ilysa-lefuan-f5eb738f.koyeb.app'; // <-- PON AQU√ç TU URL P√öBLICA

        // ============================================
        // SCRIPTS DISPONIBLES
        // ============================================
        const SCRIPTS = [
            {
                id: 'kuramoto_explorer',
                nombre: 'üåÄ Kuramoto Explorer',
                desc: 'Modelo b√°sico de 3 niveles (1+3+9 plataformas). Permite explorar K_intra y K_inter.',
                badge: '3 niveles'
            },
            {
                id: 'modelo_efectivo',
                nombre: 'üìà Modelo Efectivo 46 Capas',
                desc: 'Extrapolaci√≥n a 46 niveles usando par√°metros de orden.',
                badge: '46 capas'
            },
            {
                id: 'MacroPODB',
                nombre: 'üî¨ Macro PODB',
                desc: 'Sistema completo con 6 niveles, topolog√≠as configurables y estados P-O-D-B.',
                badge: '6 niveles + PODB'
            },
            {
                id: 'Kuramoto7_1',
                nombre: '‚öôÔ∏è Kuramoto 7.1',
                desc: 'Simulaci√≥n de 3 niveles con diferentes configuraciones de acoplamiento.',
                badge: '3 niveles'
            },
            {
                id: 'Kuramoto7_4',
                nombre: 'üîÑ Kuramoto 7.4',
                desc: 'Exploraci√≥n de 7 topolog√≠as diferentes con men√∫ interactivo.',
                badge: '7 topolog√≠as'
            },
            {
                id: 'KuramotoPRO',
                nombre: 'üöÄ Kuramoto PRO',
                desc: 'Versi√≥n inicial con 3 niveles y visualizaci√≥n b√°sica.',
                badge: 'base'
            }
        ];

        let scriptSeleccionado = null;

        // ============================================
        // RENDERIZAR TARJETAS
        // ============================================
        const scriptGrid = document.getElementById('scriptGrid');

        SCRIPTS.forEach(script => {
            const card = document.createElement('div');
            card.className = 'script-card';
            card.onclick = () => seleccionarScript(script.id);
            card.id = `card-${script.id}`;

            card.innerHTML = `
                <div class="script-name">${script.nombre}</div>
                <div class="script-desc">${script.desc}</div>
                <span class="script-badge">${script.badge}</span>
            `;

            scriptGrid.appendChild(card);
        });

        // ============================================
        // FUNCIONES DE SELECCI√ìN
        // ============================================
        function seleccionarScript(id) {
            scriptSeleccionado = id;

            // Actualizar UI
            document.querySelectorAll('.script-card').forEach(c => {
                c.classList.remove('selected');
            });
            document.getElementById(`card-${id}`).classList.add('selected');

            // Habilitar bot√≥n
            document.getElementById('btnEjecutar').disabled = false;

            // Mostrar selecci√≥n
            const script = SCRIPTS.find(s => s.id === id);
            document.getElementById('output').innerText = `‚úÖ Script seleccionado: ${script.nombre}`;
        }

        // ============================================
        // EJECUTAR SCRIPT EN KOYEB
        // ============================================
        async function ejecutarScript() {
            if (!scriptSeleccionado) {
                alert('Selecciona un script primero');
                return;
            }

            const btn = document.getElementById('btnEjecutar');
            const outputEl = document.getElementById('output');
            const plotsEl = document.getElementById('plots');

            btn.disabled = true;
            outputEl.innerText = '‚è≥ Enviando petici√≥n al servidor...';
            plotsEl.innerHTML = '';

            try {
                // Llamar al backend en Koyeb
                const response = await fetch(`${API_URL}/ejecutar/${scriptSeleccionado}`);
                const result = await response.json();

                if (result.success) {
                    // Mostrar salida de texto
                    outputEl.innerText = result.output || '‚úÖ Simulaci√≥n completada (sin salida de texto)';

                    // Mostrar gr√°fica si existe
                    if (result.imagen) {
                        plotsEl.innerHTML = `<img src="data:image/png;base64,${result.imagen}" alt="Gr√°fica de resultados">`;
                    }
                } else {
                    outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${result.error || 'Error desconocido'}</span>`;
                }
            } catch (error) {
                outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error de conexi√≥n: ${error.message}</span>`;
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
