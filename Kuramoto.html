<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ Simulaciones Kuramoto - Framework P-O-D-B</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }

        .selector-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .selector-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .script-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .script-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .script-card.selected {
            border-color: #3498db;
            background: #ebf5ff;
        }
        .script-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .script-desc {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .script-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e1f5fe;
            color: #0288d1;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .param-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }
        .param-panel h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .param-row {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .param-row label {
            font-weight: 500;
            color: #495057;
            min-width: 150px;
        }
        .param-row select {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .param-row select:hover {
            border-color: #3498db;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        .btn-ejecutar {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        .btn-ejecutar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }
        .btn-ejecutar:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results {
            margin-top: 30px;
            border-top: 2px solid #e9ecef;
            padding-top: 25px;
        }
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        #plots {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        #plots img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header style="position: relative; text-align: center; margin-bottom: 30px;">
            <h1 style="margin: 0; font-size: 2em;">LEFUAN</h1>
            <p style="margin: 0; font-size: 1em;">Exploraciones en Laniakea: Ciencia, Estrategia y Pensamiento</p>
            <img src="https://lefuan.neocities.org/Vida.png" alt="Logo Lefuan" 
                 style="position: absolute; right: 15%; top: 50%; transform: translateY(-50%); height: 140px; width: auto; border-radius: 8px;">
        </header>
        <header style="position: relative; text-align: center; margin-bottom: 0; background: linear-gradient(45deg, #2c3e50, #3498db); padding: 30px; color: white;">
            <h1 style="margin: 0; font-size: 2em;">LEFUAN</h1>
            <p style="margin: 0; font-size: 1em;">Exploraciones en Laniakea: Ciencia, Estrategia y Pensamiento</p>
            <img src="https://lefuan.neocities.org/Vida.png" alt="Logo Lefuan" 
                 style="position: absolute; right: 15%; top: 50%; transform: translateY(-50%); height: 140px; width: auto; border-radius: 8px;">
        </header>
        <div class="header">
            <h1>üåÄ Framework P-O-D-B</h1>
            <p>Simulaciones de Kuramoto jer√°rquico con estados Part√≠cula-Onda-Difuso-Borrado</p>
        </div>

        <div class="content">
            <div class="selector-panel">
                <h2>üìÅ Selecciona un script para ejecutar:</h2>

                <div class="script-grid" id="scriptGrid"></div>

                <div class="param-panel" id="paramPanel" style="display: none;">
                    <h4>‚öôÔ∏è Par√°metros del script:</h4>
                    <div id="parametros-dinamicos"></div>
                </div>

                <div class="control-panel">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <button class="btn-ejecutar" id="btnEjecutar" disabled>
                            ‚ñ∂ Ejecutar Simulaci√≥n
                        </button>
                    </div>
                </div>
            </div>

            <div class="results">
                <h3>üìä Resultados:</h3>
                <div id="output">Selecciona un script y haz clic en Ejecutar</div>
                <div id="plots"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN
        // ============================================
        const API_URL = 'https://peculiar-ilysa-lefuan-f5eb738f.koyeb.app';

        // ============================================
        // SCRIPTS DISPONIBLES
        // ============================================
        const SCRIPTS = [
            { id: 'hito1', nombre: 'üåÄ Hito 1 - KuramotoPRO', desc: 'Modelo base de 3 niveles (1+3+9 plataformas)', badge: 'Base' },
            { id: 'hito2', nombre: 'üìä Hito 2 - Kuramoto Explorer', desc: 'Exploraci√≥n de K_intra y K_inter en 3 niveles', badge: '3 niveles' },
            { id: 'hito3', nombre: '‚öôÔ∏è Hito 3 - Kuramoto7_1', desc: 'Simulaci√≥n de N niveles jer√°rquicos', badge: 'N niveles' },
            { id: 'hito4', nombre: 'üìà Hito 4 - Modelo 46 Capas', desc: 'Extrapolaci√≥n a 46 niveles con par√°metros de orden', badge: '46 capas' },
            { id: 'hito5', nombre: 'üîÑ Hito 5 - Kuramoto7_4', desc: 'Exploraci√≥n de 7 topolog√≠as diferentes', badge: '7 topolog√≠as' },
            { id: 'hito6', nombre: 'üî¨ Hito 6 - KuramotoPODB', desc: 'Estados P-O-D-B por conexi√≥n', badge: 'PODB' },
            { id: 'hito7', nombre: 'üöÄ Hito 7 - MacroPODB', desc: 'Versi√≥n unificada con todas las opciones', badge: 'Unificado' }
        ];

        // ============================================
        // PAR√ÅMETROS POR SCRIPT
        // ============================================
        const PARAMETROS_SCRIPT = {
            'hito3': [
                { nombre: 'niveles', tipo: 'select', opciones: [3,4,5,6], default: 6, label: 'N√∫mero de niveles' }
            ],
            'hito5': [
                { nombre: 'opcion', tipo: 'select', opciones: [1,2,3,4,5,6,7], default: 6, label: 'Opci√≥n de topolog√≠a' }
            ],
            'hito6': [
                { nombre: 'niveles', tipo: 'select', opciones: [2,3,4], default: 3, label: 'Niveles' },
                { nombre: 'metros', tipo: 'select', opciones: [3,4], default: 4, label: 'Metr√≥nomos/plataforma' }
            ],
            'hito7': [  // ‚Üê A√ëADIDO
                { nombre: 'opcion', tipo: 'select', opciones: [1,2,3,4,5,6,7], default: 6, label: 'Opci√≥n de topolog√≠a' },
                { nombre: 'niveles', tipo: 'select', opciones: [3,4,5,6], default: 5, label: 'N√∫mero de niveles' },
                { nombre: 'modo', tipo: 'select', opciones: ['clasico', 'podb'], default: 'podb', label: 'Modo de simulaci√≥n' }
            ]
        };

        let scriptSeleccionado = null;

        // ============================================
        // RENDERIZAR TARJETAS
        // ============================================
        const scriptGrid = document.getElementById('scriptGrid');

        SCRIPTS.forEach(script => {
            const card = document.createElement('div');
            card.className = 'script-card';
            card.onclick = () => seleccionarScript(script.id);
            card.id = `card-${script.id}`;

            card.innerHTML = `
                <div class="script-name">${script.nombre}</div>
                <div class="script-desc">${script.desc}</div>
                <span class="script-badge">${script.badge}</span>
            `;

            scriptGrid.appendChild(card);
        });

        // ============================================
        // FUNCIONES DE SELECCI√ìN
        // ============================================
        function seleccionarScript(id) {
            scriptSeleccionado = id;

            document.querySelectorAll('.script-card').forEach(c => {
                c.classList.remove('selected');
            });
            document.getElementById(`card-${id}`).classList.add('selected');
            
            document.getElementById('btnEjecutar').disabled = false;
            
            const script = SCRIPTS.find(s => s.id === id);
            document.getElementById('output').innerText = `‚úÖ Script seleccionado: ${script.nombre}`;
            
            mostrarParametros(id);
        }

        function mostrarParametros(scriptId) {
            const panel = document.getElementById('paramPanel');
            const div = document.getElementById('parametros-dinamicos');
            
            if (!PARAMETROS_SCRIPT[scriptId]) {
                panel.style.display = 'none';
                return;
            }
            
            panel.style.display = 'block';
            let html = '';
            
            PARAMETROS_SCRIPT[scriptId].forEach(param => {
                html += `<div class="param-row">`;
                html += `<label>${param.label}:</label>`;
                
                if (param.tipo === 'select') {
                    html += `<select id="param-${param.nombre}">`;
                    param.opciones.forEach(val => {
                        html += `<option value="${val}" ${val === param.default ? 'selected' : ''}>${val}</option>`;
                    });
                    html += `</select>`;
                }
                
                html += `</div>`;
            });
            
            div.innerHTML = html;
        }

        // ============================================
        // EJECUTAR SCRIPT
        // ============================================
        async function ejecutarScript() {
            if (!scriptSeleccionado) {
                alert('Selecciona un script primero');
                return;
            }

            const btn = document.getElementById('btnEjecutar');
            const outputEl = document.getElementById('output');
            const plotsEl = document.getElementById('plots');

            btn.disabled = true;
            outputEl.innerText = '‚è≥ Ejecutando en servidor...';
            plotsEl.innerHTML = '';

            try {
                // Recoger par√°metros
                const params = {};
                if (PARAMETROS_SCRIPT[scriptSeleccionado]) {
                    PARAMETROS_SCRIPT[scriptSeleccionado].forEach(param => {
                        const input = document.getElementById(`param-${param.nombre}`);
                        if (input) params[param.nombre] = input.value;
                    });
                }

                // JSONP
                const callbackName = 'callback_' + Date.now();

                const result = await new Promise((resolve, reject) => {
                    window[callbackName] = function(data) {
                        resolve(data);
                        delete window[callbackName];
                        if (script) document.head.removeChild(script);
                    };

                    let url = `${API_URL}/ejecutar/${scriptSeleccionado}?callback=${callbackName}`;
                    if (Object.keys(params).length > 0) {
                        url += '&' + new URLSearchParams(params).toString();
                    }

                    const script = document.createElement('script');
                    script.src = url;
                    script.onerror = () => reject(new Error('Error de conexi√≥n'));
                    document.head.appendChild(script);

                    setTimeout(() => reject(new Error('Timeout')), 60000);
                });

                if (result.success) {
                    outputEl.innerText = result.output || '‚úÖ Simulaci√≥n completada';

                    if (result.imagenes && result.imagenes.length > 0) {
                        let html = '';
                        result.imagenes.forEach((img, index) => {
                            html += `<img src="data:image/png;base64,${img}" alt="Gr√°fica ${index+1}">`;
                        });
                        plotsEl.innerHTML = html;
                    } else {
                        plotsEl.innerHTML = '<p>‚ö†Ô∏è El script no gener√≥ gr√°ficas</p>';
                    }
                } else {
                    outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${result.error || 'Error desconocido'}</span>`;
                }
            } catch (error) {
                outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${error.message}</span>`;
            } finally {
                btn.disabled = false;
            }
        }

        document.getElementById('btnEjecutar').onclick = ejecutarScript;
    </script>
</body>
</html>
