<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåÄ Simulaciones Kuramoto - Framework P-O-D-B</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }

        .selector-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .selector-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .script-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .script-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .script-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        .script-card.selected {
            border-color: #3498db;
            background: #ebf5ff;
        }
        .script-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .script-desc {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        .script-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e1f5fe;
            color: #0288d1;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        .btn-ejecutar {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        .btn-ejecutar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }
        .btn-ejecutar:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results {
            margin-top: 30px;
            border-top: 2px solid #e9ecef;
            padding-top: 25px;
        }
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        #output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        #plots {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        #plots img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåÄ Framework P-O-D-B</h1>
            <p>Simulaciones de Kuramoto jer√°rquico con estados Part√≠cula-Onda-Difuso-Borrado</p>
        </div>

        <div class="content">
            <div class="selector-panel">
                <h2>üìÅ Selecciona un script para ejecutar:</h2>

                <div class="script-grid" id="scriptGrid">
                    <!-- Las tarjetas se generar√°n con JavaScript -->
                </div>

                <div class="control-panel">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <button class="btn-ejecutar" id="btnEjecutar" onclick="ejecutarScript()" disabled>
                            ‚ñ∂ Ejecutar Simulaci√≥n
                        </button>
                    </div>
                </div>
            </div>

            <div class="results">
                <h3>üìä Resultados:</h3>
                <div id="output">Selecciona un script y haz clic en Ejecutar</div>
                <div id="plots"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN - CAMBIA ESTA URL POR LA DE KOYEB
        // ============================================
        const API_URL = 'https://peculiar-ilysa-lefuan-f5eb738f.koyeb.app'; // <-- PON AQU√ç TU URL P√öBLICA

        // ============================================
        // SCRIPTS DISPONIBLES
        // ============================================
        const SCRIPTS = [
            { id: 'hito1', nombre: 'üåÄ Hito 1 - KuramotoPRO', badge: 'Base' },
            { id: 'hito2', nombre: 'üìä Hito 2 - Kuramoto Explorer', badge: '3 niveles' },
            { id: 'hito3', nombre: '‚öôÔ∏è Hito 3 - Kuramoto7_1', badge: '6 niveles' },
            { id: 'hito4', nombre: 'üìà Hito 4 - Modelo 46 Capas', badge: '46 capas' },
            { id: 'hito5', nombre: 'üîÑ Hito 5 - Kuramoto7_4', badge: '7 topolog√≠as' },
            { id: 'hito6', nombre: 'üî¨ Hito 6 - KuramotoPODB', badge: 'PODB' },
            { id: 'hito7', nombre: 'üöÄ Hito 7 - MacroPODB', badge: 'Unificado' }
        ];

        let scriptSeleccionado = null;

        // ============================================
        // RENDERIZAR TARJETAS
        // ============================================
        const scriptGrid = document.getElementById('scriptGrid');

        SCRIPTS.forEach(script => {
            const card = document.createElement('div');
            card.className = 'script-card';
            card.onclick = () => seleccionarScript(script.id);
            card.id = `card-${script.id}`;

            card.innerHTML = `
                <div class="script-name">${script.nombre}</div>
                <div class="script-desc">${script.desc}</div>
                <span class="script-badge">${script.badge}</span>
            `;

            scriptGrid.appendChild(card);
        });

        // ============================================
        // FUNCIONES DE SELECCI√ìN
        // ============================================
        function seleccionarScript(id) {
            scriptSeleccionado = id;

            // Actualizar UI
            document.querySelectorAll('.script-card').forEach(c => {
                c.classList.remove('selected');
            });
            document.getElementById(`card-${id}`).classList.add('selected');

            // Habilitar bot√≥n
            document.getElementById('btnEjecutar').disabled = false;

            // Mostrar selecci√≥n
            const script = SCRIPTS.find(s => s.id === id);
            document.getElementById('output').innerText = `‚úÖ Script seleccionado: ${script.nombre}`;
        }

        // ============================================
        // EJECUTAR SCRIPT EN KOYEB
        // ============================================
        async function ejecutarScript() {
    if (!scriptSeleccionado) {
        alert('Selecciona un script primero');
        return;
    }

    const btn = document.getElementById('btnEjecutar');
    const outputEl = document.getElementById('output');
    const plotsEl = document.getElementById('plots');

    btn.disabled = true;
    outputEl.innerText = '‚è≥ Ejecutando en servidor...';
    plotsEl.innerHTML = '';

    try {
        const callbackName = 'callback_' + Date.now();

        const result = await new Promise((resolve, reject) => {
            window[callbackName] = function(data) {
                resolve(data);
                delete window[callbackName];
                if (script) document.head.removeChild(script);
            };

            const script = document.createElement('script');
            script.src = `${API_URL}/ejecutar/${scriptSeleccionado}?callback=${callbackName}`;
            script.onerror = () => reject(new Error('Error de conexi√≥n'));
            document.head.appendChild(script);

            setTimeout(() => reject(new Error('Timeout')), 60000);
        });

        if (result.success) {
            outputEl.innerText = result.output || '‚úÖ Simulaci√≥n completada';

            // ‚úÖ CORREGIDO: usar result.imagenes (plural)
            if (result.imagenes && result.imagenes.length > 0) {
                let html = '';
                result.imagenes.forEach((img, index) => {
                    html += `<img src="data:image/png;base64,${img}" alt="Gr√°fica ${index+1}" style="margin-bottom: 20px; max-width: 100%; border: 1px solid #ddd; border-radius: 5px;">`;
                });
                plotsEl.innerHTML = html;
            } else {
                plotsEl.innerHTML = '<p>‚ö†Ô∏è El script no gener√≥ gr√°ficas</p>';
            }
        } else {
            outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${result.error || 'Error desconocido'}</span>`;
        }
    } catch (error) {
        outputEl.innerHTML = `<span style="color: #ff6b6b;">‚ùå Error: ${error.message}</span>`;
    } finally {
        btn.disabled = false;
    }
}
    </script>
</body>
</html>
